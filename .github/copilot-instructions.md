# Runtime Memory Cache - GitHub Copilot Instructions

Runtime Memory Cache is a lightweight, high-performance in-memory cache for Node.js with TTL support, configurable eviction policies (FIFO/LRU), statistics tracking, and zero dependencies. This is a TypeScript library published to npm.

Always reference these instructions first and fallback to search or bash commands only when you encounter unexpected information that does not match the info here.

## Working Effectively

### Bootstrap, build, and test the repository:
- `npm install` -- takes ~16 seconds on first install, ~1 second when up-to-date. Dependencies install cleanly with some deprecation warnings (safe to ignore).
- `npm run build` -- takes ~5 seconds. NEVER CANCEL. Set timeout to 120+ seconds. Compiles TypeScript to JavaScript in `dist/` directory.
- `npm run test` -- takes ~12 seconds. NEVER CANCEL. Set timeout to 120+ seconds. Runs comprehensive test suite (114 tests pass, 1 skipped).
- `npm run test:coverage` -- takes ~14 seconds. NEVER CANCEL. Set timeout to 120+ seconds. Generates coverage report with 90.36% coverage.

### Development and testing:
- `npm run dev` -- runs the main TypeScript file via ts-node (exits immediately as it's a library)
- `npm run play` -- runs playground examples demonstrating cache functionality (takes ~3 seconds with async timeouts)
- `npm start` -- runs the compiled JavaScript version (exits immediately)
- `npm run test:watch` -- runs tests in watch mode for development
- `npm run clean` -- removes the dist/ directory before rebuild

### Build artifacts:
- `dist/` directory contains compiled JavaScript and TypeScript definitions
- `coverage/` directory contains test coverage reports (generated by jest --coverage)
- `node_modules/` contains dependencies (excluded from git)

## Validation

### ALWAYS run these validation steps after making changes:
1. `npm run build` -- ensure TypeScript compiles without errors
2. `npm run test` -- ensure all tests pass 
3. `npm run test:coverage` -- verify coverage thresholds are met (80% minimum for branches, functions, lines, statements)
4. `npm run play` -- manually verify functionality works end-to-end

### Manual testing scenarios:
- **Basic caching**: Test set/get/has/del operations work correctly
- **TTL expiration**: Test that items expire after the configured time
- **Eviction policies**: Test both FIFO and LRU eviction work as expected
- **Statistics tracking**: Verify hit/miss/eviction counts are accurate
- **Error handling**: Test validation for empty keys, long keys, negative TTL
- **Memory usage**: Test getMemoryUsage() returns reasonable estimates

### Critical validation requirement:
After making any changes to core cache functionality, ALWAYS run through the playground scenarios:
1. Basic usage with statistics and memory tracking (set/get/has operations)
2. Error handling and validation scenarios (empty keys, negative TTL, long keys)
3. TTL expiration behavior (items disappear after timeout)
4. FIFO cache eviction (oldest items removed first when cache is full)
5. LRU cache eviction (least recently used items removed when cache is full)
6. Manual cleanup of expired entries (cleanup() method removes expired items)

### Verify these specific behaviors work correctly:
- **Basic operations**: Set, get, has, del, size, clear, keys all function properly
- **TTL expiration**: Items set with TTL automatically expire and return undefined
- **FIFO eviction**: When maxSize is reached, oldest inserted item is removed first
- **LRU eviction**: When maxSize is reached and evictionPolicy='LRU', least recently accessed item is removed
- **Statistics**: Hit/miss/eviction counters update correctly when enableStats=true
- **Error handling**: Validation throws errors for set() but gracefully handles invalid inputs for get/has/del
- **Memory tracking**: getMemoryUsage() returns reasonable byte estimates

## Project Structure

### Core modules (in `src/`):
- `index.ts` -- Main RuntimeMemoryCache class implementation
- `types.ts` -- TypeScript interfaces and type definitions
- `utils.ts` -- Utility functions for cache operations (expiration, eviction, memory calculation)
- `stats.ts` -- Statistics tracking functionality
- `exports.ts` -- Centralized exports for the library
- `playground.ts` -- Demo/example usage scenarios

### Test coverage (in `tests/`):
- `basic.test.ts` -- Constructor, basic operations, configuration
- `ttl.test.ts` -- Time-to-live expiration behavior
- `eviction.test.ts` -- FIFO and LRU eviction policies
- `statistics.test.ts` -- Hit/miss/eviction tracking
- `validation.test.ts` -- Input validation and error handling
- `utils.test.ts` -- Utility function testing
- `integration.test.ts` -- Real-world usage scenarios (takes ~12 seconds due to timing tests)

### Configuration files:
- `package.json` -- npm package configuration with scripts and dependencies
- `tsconfig.json` -- TypeScript compilation settings (target: ES2019, CommonJS modules)
- `jest.config.js` -- Test configuration with coverage thresholds
- `.gitignore` -- Excludes node_modules/, dist/, coverage/

## Common Tasks

### Adding new features:
1. Update TypeScript interfaces in `types.ts` if needed
2. Implement functionality in appropriate module (`index.ts`, `utils.ts`, or `stats.ts`)
3. Add comprehensive tests covering edge cases
4. Update playground examples if the feature affects user-facing API
5. Run full validation suite

### Debugging issues:
- Use `npm run play` to reproduce issues with realistic data
- Use `npm run test:watch` for test-driven debugging
- Check test output for specific failure scenarios
- Use coverage reports to identify untested code paths

### Performance optimization:
- Focus on O(1) operations using native Map data structure
- Test with large datasets using integration tests
- Monitor memory usage via `getMemoryUsage()` method
- Verify eviction policies work efficiently under load

## Build Requirements

### Dependencies:
- **Node.js**: Version 20.19.5 or compatible (ES2019 support required)
- **npm**: Version 10.8.2 or compatible
- **TypeScript**: Version 5.8.3 (dev dependency)
- **Jest**: Version 29.7.0 for testing (dev dependency)
- **ts-node**: Version 10.9.2 for development (dev dependency)

### No linting or formatting tools configured:
This repository does not use ESLint, Prettier, or other code formatting tools. Follow existing code style and patterns.

## Key Implementation Details

### Architecture:
- Zero runtime dependencies - only uses native JavaScript/Node.js APIs
- Modular design with separated concerns (cache logic, statistics, utilities)
- Generic Map-based storage with O(1) average case performance
- TypeScript-first design with comprehensive type safety

### Cache behavior:
- **FIFO eviction**: Removes oldest inserted items first (default)
- **LRU eviction**: Removes least recently used items (configurable)
- **TTL support**: Items auto-expire based on time-to-live settings
- **Statistics tracking**: Optional hit/miss/eviction counters
- **Memory tracking**: Estimated memory usage calculation

### Error handling:
- Validation throws errors on set() but returns undefined/false on get/has/del for invalid inputs
- Empty keys and keys longer than 250 characters are rejected
- Negative TTL values are rejected
- Non-integer maxSize values are rejected

## Important Notes

- **NEVER CANCEL** any build or test commands - they complete quickly but set appropriate timeouts
- The library exports both named exports and a default export for maximum compatibility
- All timing-sensitive tests use appropriate delays and are marked with increased Jest timeouts
- Memory usage calculations are estimates based on JSON serialization size
- LRU implementation uses Map deletion/reinsertion to maintain access order while preserving metadata

## Common File Outputs

### Repository root listing:
```
.git/
.gitignore
CHANGELOG.md
LICENSE
README.md
jest.config.js
node_modules/
package-lock.json
package.json
src/
tests/
tsconfig.json
```

### Source directory (src/):
```
exports.ts
index.ts
playground.ts
stats.ts
types.ts
utils.ts
```

### Test directory (tests/):
```
basic.test.ts
eviction.test.ts
integration.test.ts
statistics.test.ts
ttl.test.ts
utils.test.ts
validation.test.ts
```