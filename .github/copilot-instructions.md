# Runtime Memory Cache - GitHub Copilot Instructions

Runtime Memory Cache is a lightweight, high-performance in-memory cache for Node.js with TTL support, configurable eviction policies (FIFO/LRU), statistics tracking, and zero dependencies. This is a TypeScript library published to npm.

Always reference these instructions first and fallback to search or bash commands only when you encounter unexpected information that does not match the info here.

## Working Effectively

### Bootstrap, build, and test the repository:
- `npm install` -- takes ~16 seconds on first install, ~1 second when up-to-date. Dependencies install cleanly with some deprecation warnings (safe to ignore).
- `npm run build` -- takes ~5 seconds. NEVER CANCEL. Set timeout to 120+ seconds. Compiles TypeScript to JavaScript in `dist/` directory.
- `npm run test` -- takes ~12 seconds. NEVER CANCEL. Set timeout to 120+ seconds. Runs comprehensive test suite (114 tests pass, 1 skipped).
- `npm run test:coverage` -- takes ~14 seconds. NEVER CANCEL. Set timeout to 120+ seconds. Generates coverage report with 90.36% coverage.

### Development and testing:
- `npm run dev` -- runs the main TypeScript file via ts-node (exits immediately as it's a library)
- `npm run play` -- runs playground examples demonstrating cache functionality (takes ~3 seconds with async timeouts)
- `npm start` -- runs the compiled JavaScript version (exits immediately)
- `npm run test:watch` -- runs tests in watch mode for development
- `npm run clean` -- removes the dist/ directory before rebuild

### Build artifacts:
- `dist/` directory contains compiled JavaScript and TypeScript definitions
- `coverage/` directory contains test coverage reports (generated by jest --coverage)
- `node_modules/` contains dependencies (excluded from git)

## Validation

### ALWAYS run these validation steps after making changes:
1. `npm run build` -- ensure TypeScript compiles without errors
2. `npm run test` -- ensure all tests pass 
3. `npm run test:coverage` -- verify coverage thresholds are met (80% minimum for branches, functions, lines, statements)
4. `npm run play` -- manually verify functionality works end-to-end

### Manual testing scenarios:
- **Basic caching**: Test set/get/has/del operations work correctly
- **TTL expiration**: Test that items expire after the configured time
- **Eviction policies**: Test both FIFO and LRU eviction work as expected
- **Statistics tracking**: Verify hit/miss/eviction counts are accurate
- **Error handling**: Test validation for empty keys, long keys, negative TTL
- **Memory usage**: Test getMemoryUsage() returns reasonable estimates

### Critical validation requirement:
After making any changes to core cache functionality, ALWAYS run through the playground scenarios:
1. Basic usage with statistics and memory tracking (set/get/has operations)
2. Error handling and validation scenarios (empty keys, negative TTL, long keys)
3. TTL expiration behavior (items disappear after timeout)
4. FIFO cache eviction (oldest items removed first when cache is full)
5. LRU cache eviction (least recently used items removed when cache is full)
6. Manual cleanup of expired entries (cleanup() method removes expired items)

### Verify these specific behaviors work correctly:
- **Basic operations**: Set, get, has, del, size, clear, keys all function properly
- **TTL expiration**: Items set with TTL automatically expire and return undefined
- **FIFO eviction**: When maxSize is reached, oldest inserted item is removed first
- **LRU eviction**: When maxSize is reached and evictionPolicy='LRU', least recently accessed item is removed
- **Statistics**: Hit/miss/eviction counters update correctly when enableStats=true
- **Error handling**: Validation throws errors for set() but gracefully handles invalid inputs for get/has/del
- **Memory tracking**: getMemoryUsage() returns reasonable byte estimates

## Project Structure

### Core modules (in `src/`):
- `index.ts` -- Main RuntimeMemoryCache class implementation
- `types.ts` -- TypeScript interfaces and type definitions
- `utils.ts` -- Utility functions for cache operations (expiration, eviction, memory calculation)
- `stats.ts` -- Statistics tracking functionality
- `exports.ts` -- Centralized exports for the library
- `playground.ts` -- Demo/example usage scenarios

### Test coverage (in `tests/`):
- `basic.test.ts` -- Constructor, basic operations, configuration
- `ttl.test.ts` -- Time-to-live expiration behavior
- `eviction.test.ts` -- FIFO and LRU eviction policies
- `statistics.test.ts` -- Hit/miss/eviction tracking
- `validation.test.ts` -- Input validation and error handling
- `utils.test.ts` -- Utility function testing
- `integration.test.ts` -- Real-world usage scenarios (takes ~12 seconds due to timing tests)

### Configuration files:
- `package.json` -- npm package configuration with scripts and dependencies
- `tsconfig.json` -- TypeScript compilation settings (target: ES2019, CommonJS modules)
- `jest.config.js` -- Test configuration with coverage thresholds
- `.gitignore` -- Excludes node_modules/, dist/, coverage/

## Common Tasks

### Adding new features:
1. Update TypeScript interfaces in `types.ts` if needed
2. Implement functionality in appropriate module (`index.ts`, `utils.ts`, or `stats.ts`)
3. Add comprehensive tests covering edge cases
4. Update playground examples if the feature affects user-facing API
5. Update CHANGELOG.md and README.md documentation
6. Update package version following semantic versioning rules
7. Run full validation suite

### Debugging issues:
- Use `npm run play` to reproduce issues with realistic data
- Use `npm run test:watch` for test-driven debugging
- Check test output for specific failure scenarios
- Use coverage reports to identify untested code paths

### Performance optimization:
- Focus on O(1) operations using native Map data structure
- Test with large datasets using integration tests
- Monitor memory usage via `getMemoryUsage()` method
- Verify eviction policies work efficiently under load

## Documentation and Release Management

### Changelog Management (CHANGELOG.md):
The project follows [Keep a Changelog](https://keepachangelog.com/en/1.0.0/) format and [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

**ALWAYS update CHANGELOG.md when making changes:**

1. **Add unreleased changes** to the `[Unreleased]` section at the top
2. **Use the correct category headers:**
   - `### Added` - for new features
   - `### Changed` - for changes in existing functionality
   - `### Deprecated` - for soon-to-be removed features
   - `### Removed` - for now removed features
   - `### Fixed` - for any bug fixes
   - `### Security` - in case of vulnerabilities

3. **Format entries consistently:**
   - Use bullet points with descriptive messages
   - Include **bold keywords** for feature names
   - Provide context about the change and its impact
   - Reference specific methods, interfaces, or modules affected

4. **Example changelog entry format:**
   ```markdown
   ## [Unreleased]
   
   ### Added
   - **New Eviction Policy**: Added support for Time-Based eviction policy alongside FIFO and LRU
   - **Enhanced Statistics**: Added `averageAccessTime` and `hotKeys` tracking to cache statistics
   
   ### Changed
   - **API Enhancement**: Updated `CacheOptions` interface to include `evictionPolicy` with 'TIME_BASED' option
   - **Performance Improvement**: Optimized key lookup performance by 15% using native Map enhancements
   
   ### Fixed
   - **TTL Bug**: Fixed issue where TTL values were not properly validated for negative numbers
   ```

5. **When releasing a version:**
   - Move `[Unreleased]` content to a new versioned section like `[X.Y.Z] - YYYY-MM-DD`
   - Clear the `[Unreleased]` section and add `<!-- No unreleased changes yet -->`

### README Documentation Updates:
The README.md follows a structured format with emoji headers and comprehensive sections.

**ALWAYS update README.md for user-facing changes:**

1. **Update version badges** if the npm package version changes
2. **Update Features section (‚ú® Features)** for new capabilities
3. **Update API Reference section (üìö API Reference)** for:
   - New constructor options in `CacheOptions` interface
   - New methods in the main class
   - Changed method signatures or behavior
   - New return types or interfaces

4. **Update Usage Examples section (üîß Usage Examples)** for:
   - New features that benefit from examples
   - Changes to existing API usage patterns
   - New configuration options or best practices

5. **Update Architecture section (üèóÔ∏è Architecture)** if:
   - New modules are added to `src/`
   - Existing modules get significant functionality changes
   - New design patterns or architectural decisions

6. **Maintain consistency:**
   - Keep the emoji-based section headers consistent
   - Use TypeScript code blocks with proper syntax highlighting
   - Include practical, realistic examples
   - Update any performance claims or statistics if they change

### Package Version Management (Semantic Versioning):
This project strictly follows [Semantic Versioning (SemVer)](https://semver.org/spec/v2.0.0.html) rules.

**Version format: MAJOR.MINOR.PATCH (e.g., 1.2.3)**

**ALWAYS update package.json version appropriately:**

1. **PATCH version (0.0.X)** - increment for:
   - Bug fixes that don't break existing functionality
   - Performance improvements without API changes
   - Documentation updates
   - Internal refactoring without behavior changes
   - Test improvements
   - Examples: 0.3.1 ‚Üí 0.3.2

2. **MINOR version (0.X.0)** - increment for:
   - New features that are backward compatible
   - New methods or options added to existing interfaces
   - New optional configuration parameters
   - Enhanced functionality that doesn't break existing code
   - Examples: 0.3.1 ‚Üí 0.4.0

3. **MAJOR version (X.0.0)** - increment for:
   - Breaking changes to public API
   - Removal of deprecated features
   - Changes to method signatures that break existing code
   - Changes to default behavior that could break existing applications
   - Examples: 0.3.1 ‚Üí 1.0.0

**Version update process:**
1. **Determine the appropriate version bump** based on the changes made
2. **Update `package.json`** version field manually
3. **Update CHANGELOG.md** with the new version section
4. **Ensure all tests pass** before releasing
5. **Use `npm run publishPackage`** script for publishing (runs clean, build, test, and publish)

**Examples of version bumping:**
- **Patch (0.3.1 ‚Üí 0.3.2)**: Fix TTL validation bug, improve test coverage, update documentation
- **Minor (0.3.1 ‚Üí 0.4.0)**: Add new `getHotKeys()` method, add new eviction policy option, add new statistics fields
- **Major (0.3.1 ‚Üí 1.0.0)**: Remove deprecated methods, change constructor signature, change default eviction policy

### Release Process Validation:
**ALWAYS follow this checklist before releasing:**

1. **Code Quality:**
   - [ ] `npm run build` - TypeScript compiles without errors
   - [ ] `npm run test` - All tests pass (expect 114+ tests)
   - [ ] `npm run test:coverage` - Coverage thresholds met (80%+ minimum)
   - [ ] `npm run play` - Manual playground verification works

2. **Documentation:**
   - [ ] CHANGELOG.md updated with appropriate version section
   - [ ] README.md updated for any API or feature changes
   - [ ] package.json version updated following SemVer rules
   - [ ] All new features documented with examples

3. **Release:**
   - [ ] Use `npm run publishPackage` for consistent release process
   - [ ] Verify the package appears correctly on npm
   - [ ] Test installation and usage in a separate project

**Pre-release checklist for major features:**
- [ ] Playground examples demonstrate the new functionality
- [ ] Integration tests cover real-world usage scenarios
- [ ] Performance impact measured and documented
- [ ] Breaking change documentation is comprehensive
- [ ] Migration guide provided for major version bumps

## Build Requirements

### Dependencies:
- **Node.js**: Version 20.19.5 or compatible (ES2019 support required)
- **npm**: Version 10.8.2 or compatible
- **TypeScript**: Version 5.8.3 (dev dependency)
- **Jest**: Version 29.7.0 for testing (dev dependency)
- **ts-node**: Version 10.9.2 for development (dev dependency)

### No linting or formatting tools configured:
This repository does not use ESLint, Prettier, or other code formatting tools. Follow existing code style and patterns.

## Key Implementation Details

### Architecture:
- Zero runtime dependencies - only uses native JavaScript/Node.js APIs
- Modular design with separated concerns (cache logic, statistics, utilities)
- Generic Map-based storage with O(1) average case performance
- TypeScript-first design with comprehensive type safety

### Cache behavior:
- **FIFO eviction**: Removes oldest inserted items first (default)
- **LRU eviction**: Removes least recently used items (configurable)
- **TTL support**: Items auto-expire based on time-to-live settings
- **Statistics tracking**: Optional hit/miss/eviction counters
- **Memory tracking**: Estimated memory usage calculation

### Error handling:
- Validation throws errors on set() but returns undefined/false on get/has/del for invalid inputs
- Empty keys and keys longer than 250 characters are rejected
- Negative TTL values are rejected
- Non-integer maxSize values are rejected

## Important Notes

- **NEVER CANCEL** any build or test commands - they complete quickly but set appropriate timeouts
- The library exports both named exports and a default export for maximum compatibility
- All timing-sensitive tests use appropriate delays and are marked with increased Jest timeouts
- Memory usage calculations are estimates based on JSON serialization size
- LRU implementation uses Map deletion/reinsertion to maintain access order while preserving metadata

## Common File Outputs

### Repository root listing:
```
.git/
.gitignore
CHANGELOG.md
LICENSE
README.md
jest.config.js
node_modules/
package-lock.json
package.json
src/
tests/
tsconfig.json
```

### Source directory (src/):
```
exports.ts
index.ts
playground.ts
stats.ts
types.ts
utils.ts
```

### Test directory (tests/):
```
basic.test.ts
eviction.test.ts
integration.test.ts
statistics.test.ts
ttl.test.ts
utils.test.ts
validation.test.ts
```